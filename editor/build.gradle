
plugins {
    id 'java-library'
    alias(libs.plugins.lombok)
}

dependencies {

    api libs.bongo.engine
    api project(":runtimes:talos-bongo")

    api libs.visui

    implementation libs.string.similarity

    implementation libs.spine.libgdx

    implementation libs.snakeyaml

    implementation libs.tiny.gizmo

}


sourceSets.main.java.srcDirs = [ "src/" ]
sourceSets.main.resources.srcDirs = ["assets"]




def getGitHash = { ->
    def stdout = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'rev-parse', '--short', 'HEAD'
        standardOutput = stdout
    }
    return stdout.toString().trim()
}

task createProperties () {
    doFirst {

        def file = rootProject.file("editor/assets/talos-version.properties");
        Properties properties = new Properties();
        if (file.exists()) {
            properties.load(file.newReader());
        }
        properties.setProperty("version", project.version);
        properties.setProperty("buildHash", getGitHash());
        properties.setProperty("buildTime", System.currentTimeMillis() + "");

        properties.store(file.newPrintWriter(), "");
    }
}

classes {
    dependsOn createProperties
}

task packageSources(type: Jar, dependsOn: classes) {
    from delombok
    from sourceSets.main.resources.srcDirs
    archiveClassifier = 'web'
}

configurations {
    web {
        canBeConsumed true
        canBeResolved false
        extendsFrom implementation, runtimeOnly
    }
}

artifacts {
    web(packageSources)
}
