{"version":3,"file":"broadcastQueryClient-experimental.development.js","sources":["../node_modules/broadcast-channel/dist/es/util.js","../node_modules/broadcast-channel/dist/es/methods/native.js","../node_modules/broadcast-channel/dist/es/oblivious-set.js","../node_modules/broadcast-channel/dist/es/options.js","../node_modules/broadcast-channel/dist/es/methods/indexed-db.js","../node_modules/broadcast-channel/dist/es/methods/localstorage.js","../node_modules/broadcast-channel/dist/es/methods/simulate.js","../node_modules/broadcast-channel/dist/es/method-chooser.js","../node_modules/broadcast-channel/dist/es/broadcast-channel.js","../src/broadcastQueryClient-experimental/index.ts"],"sourcesContent":["/**\n * returns true if the given object is a promise\n */\nexport function isPromise(obj) {\n  if (obj && typeof obj.then === 'function') {\n    return true;\n  } else {\n    return false;\n  }\n}\nexport function sleep(time) {\n  if (!time) time = 0;\n  return new Promise(function (res) {\n    return setTimeout(res, time);\n  });\n}\nexport function randomInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n/**\n * https://stackoverflow.com/a/8084248\n */\n\nexport function randomToken() {\n  return Math.random().toString(36).substring(2);\n}\nvar lastMs = 0;\nvar additional = 0;\n/**\n * returns the current time in micro-seconds,\n * WARNING: This is a pseudo-function\n * Performance.now is not reliable in webworkers, so we just make sure to never return the same time.\n * This is enough in browsers, and this function will not be used in nodejs.\n * The main reason for this hack is to ensure that BroadcastChannel behaves equal to production when it is used in fast-running unit tests.\n */\n\nexport function microSeconds() {\n  var ms = new Date().getTime();\n\n  if (ms === lastMs) {\n    additional++;\n    return ms * 1000 + additional;\n  } else {\n    lastMs = ms;\n    additional = 0;\n    return ms * 1000;\n  }\n}\n/**\n * copied from the 'detect-node' npm module\n * We cannot use the module directly because it causes problems with rollup\n * @link https://github.com/iliakan/detect-node/blob/master/index.js\n */\n\nexport var isNode = Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]';","import { microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nexport var type = 'native';\nexport function create(channelName) {\n  var state = {\n    messagesCallback: null,\n    bc: new BroadcastChannel(channelName),\n    subFns: [] // subscriberFunctions\n\n  };\n\n  state.bc.onmessage = function (msg) {\n    if (state.messagesCallback) {\n      state.messagesCallback(msg.data);\n    }\n  };\n\n  return state;\n}\nexport function close(channelState) {\n  channelState.bc.close();\n  channelState.subFns = [];\n}\nexport function postMessage(channelState, messageJson) {\n  channelState.bc.postMessage(messageJson, false);\n}\nexport function onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  /**\n   * in the electron-renderer, isNode will be true even if we are in browser-context\n   * so we also check if window is undefined\n   */\n  if (isNode && typeof window === 'undefined') return false;\n\n  if (typeof BroadcastChannel === 'function') {\n    if (BroadcastChannel._pubkey) {\n      throw new Error('BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill');\n    }\n\n    return true;\n  } else return false;\n}\nexport function averageResponseTime() {\n  return 150;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n * @constructor\n */\nvar ObliviousSet = function ObliviousSet(ttl) {\n  var set = new Set();\n  var timeMap = new Map();\n  this.has = set.has.bind(set);\n\n  this.add = function (value) {\n    timeMap.set(value, now());\n    set.add(value);\n\n    _removeTooOldValues();\n  };\n\n  this.clear = function () {\n    set.clear();\n    timeMap.clear();\n  };\n\n  function _removeTooOldValues() {\n    var olderThen = now() - ttl;\n    var iterator = set[Symbol.iterator]();\n\n    while (true) {\n      var value = iterator.next().value;\n      if (!value) return; // no more elements\n\n      var time = timeMap.get(value);\n\n      if (time < olderThen) {\n        timeMap[\"delete\"](value);\n        set[\"delete\"](value);\n      } else {\n        // we reached a value that is not old enough\n        return;\n      }\n    }\n  }\n};\n\nfunction now() {\n  return new Date().getTime();\n}\n\nexport default ObliviousSet;","export function fillOptionsWithDefaults() {\n  var originalOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var options = JSON.parse(JSON.stringify(originalOptions)); // main\n\n  if (typeof options.webWorkerSupport === 'undefined') options.webWorkerSupport = true; // indexed-db\n\n  if (!options.idb) options.idb = {}; //  after this time the messages get deleted\n\n  if (!options.idb.ttl) options.idb.ttl = 1000 * 45;\n  if (!options.idb.fallbackInterval) options.idb.fallbackInterval = 150; //  handles abrupt db onclose events.\n\n  if (originalOptions.idb && typeof originalOptions.idb.onclose === 'function') options.idb.onclose = originalOptions.idb.onclose; // localstorage\n\n  if (!options.localstorage) options.localstorage = {};\n  if (!options.localstorage.removeTimeout) options.localstorage.removeTimeout = 1000 * 60; // custom methods\n\n  if (originalOptions.methods) options.methods = originalOptions.methods; // node\n\n  if (!options.node) options.node = {};\n  if (!options.node.ttl) options.node.ttl = 1000 * 60 * 2; // 2 minutes;\n\n  if (typeof options.node.useFastPath === 'undefined') options.node.useFastPath = true;\n  return options;\n}","/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n */\nimport { sleep, randomInt, randomToken, microSeconds as micro, isNode } from '../util.js';\nexport var microSeconds = micro;\nimport ObliviousSet from '../oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nvar DB_PREFIX = 'pubkey.broadcast-channel-0-';\nvar OBJECT_STORE_ID = 'messages';\nexport var type = 'idb';\nexport function getIdb() {\n  if (typeof indexedDB !== 'undefined') return indexedDB;\n\n  if (typeof window !== 'undefined') {\n    if (typeof window.mozIndexedDB !== 'undefined') return window.mozIndexedDB;\n    if (typeof window.webkitIndexedDB !== 'undefined') return window.webkitIndexedDB;\n    if (typeof window.msIndexedDB !== 'undefined') return window.msIndexedDB;\n  }\n\n  return false;\n}\nexport function createDatabase(channelName) {\n  var IndexedDB = getIdb(); // create table\n\n  var dbName = DB_PREFIX + channelName;\n  var openRequest = IndexedDB.open(dbName, 1);\n\n  openRequest.onupgradeneeded = function (ev) {\n    var db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n  };\n\n  var dbPromise = new Promise(function (res, rej) {\n    openRequest.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    openRequest.onsuccess = function () {\n      res(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n/**\n * writes the new message to the database\n * so other readers can find it\n */\n\nexport function writeMessage(db, readerUuid, messageJson) {\n  var time = new Date().getTime();\n  var writeObject = {\n    uuid: readerUuid,\n    time: time,\n    data: messageJson\n  };\n  var transaction = db.transaction([OBJECT_STORE_ID], 'readwrite');\n  return new Promise(function (res, rej) {\n    transaction.oncomplete = function () {\n      return res();\n    };\n\n    transaction.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    var objectStore = transaction.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n  });\n}\nexport function getAllMessages(db) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        ret.push(cursor.value); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n        cursor[\"continue\"]();\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function getMessagesHigherThan(db, lastCursorId) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      var keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch (e) {\n      return objectStore.openCursor();\n    }\n  }\n\n  return new Promise(function (res) {\n    openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor[\"continue\"](lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor[\"continue\"]();\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function removeMessageById(db, id) {\n  var request = db.transaction([OBJECT_STORE_ID], 'readwrite').objectStore(OBJECT_STORE_ID)[\"delete\"](id);\n  return new Promise(function (res) {\n    request.onsuccess = function () {\n      return res();\n    };\n  });\n}\nexport function getOldMessages(db, ttl) {\n  var olderThen = new Date().getTime() - ttl;\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        var msgObk = cursor.value;\n\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n          cursor[\"continue\"]();\n        } else {\n          // no more old messages,\n          res(ret);\n          return;\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(function (tooOld) {\n    return Promise.all(tooOld.map(function (msgObj) {\n      return removeMessageById(db, msgObj.id);\n    }));\n  });\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  return createDatabase(channelName).then(function (db) {\n    var state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName: channelName,\n      options: options,\n      uuid: randomToken(),\n\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: Promise.resolve(),\n      messagesCallback: null,\n      readQueuePromises: [],\n      db: db\n    };\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n\n\n    _readLoop(state);\n\n    return state;\n  });\n}\n\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(function () {\n    return sleep(state.options.idb.fallbackInterval);\n  }).then(function () {\n    return _readLoop(state);\n  });\n}\n\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n\n  return true;\n}\n/**\n * reads all new messages from the database and emits them\n */\n\n\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return Promise.resolve(); // if no one is listening, we do not need to scan for new messages\n\n  if (!state.messagesCallback) return Promise.resolve();\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(function (newerMessages) {\n    var useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */\n    .filter(function (msgObj) {\n      return !!msgObj;\n    }).map(function (msgObj) {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n\n      return msgObj;\n    }).filter(function (msgObj) {\n      return _filterMessage(msgObj, state);\n    }).sort(function (msgObjA, msgObjB) {\n      return msgObjA.time - msgObjB.time;\n    }); // sort by time\n\n    useMessages.forEach(function (msgObj) {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return Promise.resolve();\n  });\n}\n\nexport function close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\nexport function postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(function () {\n    return writeMessage(channelState.db, channelState.uuid, messageJson);\n  }).then(function () {\n    if (randomInt(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n  });\n  return channelState.writeBlockPromise;\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\nexport function averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nimport ObliviousSet from '../oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nimport { sleep, randomToken, microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nexport var type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexport function getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\nexport function storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    sleep().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: randomToken(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nexport function addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\nexport function removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = randomToken();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nexport function close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\nexport function averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","import { microSeconds as micro } from '../util';\nexport var microSeconds = micro;\nexport var type = 'simulate';\nvar SIMULATE_CHANNELS = new Set();\nexport function create(channelName) {\n  var state = {\n    name: channelName,\n    messagesCallback: null\n  };\n  SIMULATE_CHANNELS.add(state);\n  return state;\n}\nexport function close(channelState) {\n  SIMULATE_CHANNELS[\"delete\"](channelState);\n}\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    return setTimeout(function () {\n      var channelArray = Array.from(SIMULATE_CHANNELS);\n      channelArray.filter(function (channel) {\n        return channel.name === channelState.name;\n      }).filter(function (channel) {\n        return channel !== channelState;\n      }).filter(function (channel) {\n        return !!channel.messagesCallback;\n      }).forEach(function (channel) {\n        return channel.messagesCallback(messageJson);\n      });\n      res();\n    }, 5);\n  });\n}\nexport function onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  return true;\n}\nexport function averageResponseTime() {\n  return 5;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","import NativeMethod from './methods/native.js';\nimport IndexeDbMethod from './methods/indexed-db.js';\nimport LocalstorageMethod from './methods/localstorage.js';\nimport SimulateMethod from './methods/simulate.js';\nimport { isNode } from './util'; // order is important\n\nvar METHODS = [NativeMethod, // fastest\nIndexeDbMethod, LocalstorageMethod];\n/**\n * The NodeMethod is loaded lazy\n * so it will not get bundled in browser-builds\n */\n\nif (isNode) {\n  /**\n   * we use the non-transpiled code for nodejs\n   * because it runs faster\n   */\n  var NodeMethod = require('../../src/methods/' + // use this hack so that browserify and others\n  // do not import the node-method by default\n  // when bundling.\n  'node.js');\n  /**\n   * this will be false for webpackbuilds\n   * which will shim the node-method with an empty object {}\n   */\n\n\n  if (typeof NodeMethod.canBeUsed === 'function') {\n    METHODS.push(NodeMethod);\n  }\n}\n\nexport function chooseMethod(options) {\n  var chooseMethods = [].concat(options.methods, METHODS).filter(Boolean); // directly chosen\n\n  if (options.type) {\n    if (options.type === 'simulate') {\n      // only use simulate-method if directly chosen\n      return SimulateMethod;\n    }\n\n    var ret = chooseMethods.find(function (m) {\n      return m.type === options.type;\n    });\n    if (!ret) throw new Error('method-type ' + options.type + ' not found');else return ret;\n  }\n  /**\n   * if no webworker support is needed,\n   * remove idb from the list so that localstorage is been chosen\n   */\n\n\n  if (!options.webWorkerSupport && !isNode) {\n    chooseMethods = chooseMethods.filter(function (m) {\n      return m.type !== 'idb';\n    });\n  }\n\n  var useMethod = chooseMethods.find(function (method) {\n    return method.canBeUsed();\n  });\n  if (!useMethod) throw new Error('No useable methode found:' + JSON.stringify(METHODS.map(function (m) {\n    return m.type;\n  })));else return useMethod;\n}","import { isPromise } from './util.js';\nimport { chooseMethod } from './method-chooser.js';\nimport { fillOptionsWithDefaults } from './options.js';\nexport var BroadcastChannel = function BroadcastChannel(name, options) {\n  this.name = name;\n\n  if (ENFORCED_OPTIONS) {\n    options = ENFORCED_OPTIONS;\n  }\n\n  this.options = fillOptionsWithDefaults(options);\n  this.method = chooseMethod(this.options); // isListening\n\n  this._iL = false;\n  /**\n   * _onMessageListener\n   * setting onmessage twice,\n   * will overwrite the first listener\n   */\n\n  this._onML = null;\n  /**\n   * _addEventListeners\n   */\n\n  this._addEL = {\n    message: [],\n    internal: []\n  };\n  /**\n   * _beforeClose\n   * array of promises that will be awaited\n   * before the channel is closed\n   */\n\n  this._befC = [];\n  /**\n   * _preparePromise\n   */\n\n  this._prepP = null;\n\n  _prepareChannel(this);\n}; // STATICS\n\n/**\n * used to identify if someone overwrites\n * window.BroadcastChannel with this\n * See methods/native.js\n */\n\nBroadcastChannel._pubkey = true;\n/**\n * clears the tmp-folder if is node\n * @return {Promise<boolean>} true if has run, false if not node\n */\n\nexport function clearNodeFolder(options) {\n  options = fillOptionsWithDefaults(options);\n  var method = chooseMethod(options);\n\n  if (method.type === 'node') {\n    return method.clearNodeFolder().then(function () {\n      return true;\n    });\n  } else {\n    return Promise.resolve(false);\n  }\n}\n/**\n * if set, this method is enforced,\n * no mather what the options are\n */\n\nvar ENFORCED_OPTIONS;\nexport function enforceOptions(options) {\n  ENFORCED_OPTIONS = options;\n} // PROTOTYPE\n\nBroadcastChannel.prototype = {\n  postMessage: function postMessage(msg) {\n    if (this.closed) {\n      throw new Error('BroadcastChannel.postMessage(): ' + 'Cannot post message after channel has closed');\n    }\n\n    return _post(this, 'message', msg);\n  },\n  postInternal: function postInternal(msg) {\n    return _post(this, 'internal', msg);\n  },\n\n  set onmessage(fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _removeListenerObject(this, 'message', this._onML);\n\n    if (fn && typeof fn === 'function') {\n      this._onML = listenObj;\n\n      _addListenerObject(this, 'message', listenObj);\n    } else {\n      this._onML = null;\n    }\n  },\n\n  addEventListener: function addEventListener(type, fn) {\n    var time = this.method.microSeconds();\n    var listenObj = {\n      time: time,\n      fn: fn\n    };\n\n    _addListenerObject(this, type, listenObj);\n  },\n  removeEventListener: function removeEventListener(type, fn) {\n    var obj = this._addEL[type].find(function (obj) {\n      return obj.fn === fn;\n    });\n\n    _removeListenerObject(this, type, obj);\n  },\n  close: function close() {\n    var _this = this;\n\n    if (this.closed) return;\n    this.closed = true;\n    var awaitPrepare = this._prepP ? this._prepP : Promise.resolve();\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare.then(function () {\n      return Promise.all(_this._befC.map(function (fn) {\n        return fn();\n      }));\n    }).then(function () {\n      return _this.method.close(_this._state);\n    });\n  },\n\n  get type() {\n    return this.method.type;\n  }\n\n};\n\nfunction _post(broadcastChannel, type, msg) {\n  var time = broadcastChannel.method.microSeconds();\n  var msgObj = {\n    time: time,\n    type: type,\n    data: msg\n  };\n  var awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : Promise.resolve();\n  return awaitPrepare.then(function () {\n    return broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n  });\n}\n\nfunction _prepareChannel(channel) {\n  var maybePromise = channel.method.create(channel.name, channel.options);\n\n  if (isPromise(maybePromise)) {\n    channel._prepP = maybePromise;\n    maybePromise.then(function (s) {\n      // used in tests to simulate slow runtime\n\n      /*if (channel.options.prepareDelay) {\n           await new Promise(res => setTimeout(res, this.options.prepareDelay));\n      }*/\n      channel._state = s;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\n\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\n\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n\n  _startListening(channel);\n}\n\nfunction _removeListenerObject(channel, type, obj) {\n  channel._addEL[type] = channel._addEL[type].filter(function (o) {\n    return o !== obj;\n  });\n\n  _stopListening(channel);\n}\n\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    // someone is listening, start subscribing\n    var listenerFn = function listenerFn(msgObj) {\n      channel._addEL[msgObj.type].forEach(function (obj) {\n        if (msgObj.time >= obj.time) {\n          obj.fn(msgObj.data);\n        }\n      });\n    };\n\n    var time = channel.method.microSeconds();\n\n    if (channel._prepP) {\n      channel._prepP.then(function () {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\n\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    // noone is listening, stop subscribing\n    channel._iL = false;\n    var time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}","import { BroadcastChannel } from 'broadcast-channel'\nimport { QueryClient } from '../core'\n\ninterface BroadcastQueryClientOptions {\n  queryClient: QueryClient\n  broadcastChannel?: string\n}\n\nexport function broadcastQueryClient({\n  queryClient,\n  broadcastChannel = 'react-query',\n}: BroadcastQueryClientOptions) {\n  let transaction = false\n  const tx = (cb: () => void) => {\n    transaction = true\n    cb()\n    transaction = false\n  }\n\n  const channel = new BroadcastChannel(broadcastChannel, {\n    webWorkerSupport: false,\n  })\n\n  const queryCache = queryClient.getQueryCache()\n\n  queryClient.getQueryCache().subscribe(queryEvent => {\n    if (transaction || !queryEvent?.query) {\n      return\n    }\n\n    const {\n      query: { queryHash, queryKey, state },\n    } = queryEvent\n\n    if (\n      queryEvent.type === 'queryUpdated' &&\n      queryEvent.action?.type === 'success'\n    ) {\n      channel.postMessage({\n        type: 'queryUpdated',\n        queryHash,\n        queryKey,\n        state,\n      })\n    }\n\n    if (queryEvent.type === 'queryRemoved') {\n      channel.postMessage({\n        type: 'queryRemoved',\n        queryHash,\n        queryKey,\n      })\n    }\n  })\n\n  channel.onmessage = action => {\n    if (!action?.type) {\n      return\n    }\n\n    tx(() => {\n      const { type, queryHash, queryKey, state } = action\n\n      if (type === 'queryUpdated') {\n        const query = queryCache.get(queryHash)\n\n        if (query) {\n          query.setState(state)\n          return\n        }\n\n        queryCache.build(\n          queryClient,\n          {\n            queryKey,\n            queryHash,\n          },\n          state\n        )\n      } else if (type === 'queryRemoved') {\n        const query = queryCache.get(queryHash)\n\n        if (query) {\n          queryCache.remove(query)\n        }\n      }\n    })\n  }\n}\n"],"names":["isPromise","obj","then","sleep","time","Promise","res","setTimeout","randomInt","min","max","Math","floor","random","randomToken","toString","substring","lastMs","additional","microSeconds","ms","Date","getTime","isNode","Object","prototype","call","process","micro","type","create","channelName","state","messagesCallback","bc","BroadcastChannel","subFns","onmessage","msg","data","close","channelState","postMessage","messageJson","onMessage","fn","canBeUsed","window","_pubkey","Error","averageResponseTime","ObliviousSet","ttl","set","Set","timeMap","Map","has","bind","add","value","now","_removeTooOldValues","clear","olderThen","iterator","Symbol","next","get","fillOptionsWithDefaults","originalOptions","arguments","length","undefined","options","JSON","parse","stringify","webWorkerSupport","idb","fallbackInterval","onclose","localstorage","removeTimeout","methods","node","useFastPath","DB_PREFIX","OBJECT_STORE_ID","getIdb","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","createDatabase","IndexedDB","dbName","openRequest","open","onupgradeneeded","ev","db","target","result","createObjectStore","keyPath","autoIncrement","dbPromise","rej","onerror","onsuccess","writeMessage","readerUuid","writeObject","uuid","transaction","oncomplete","objectStore","getMessagesHigherThan","lastCursorId","ret","openCursor","keyRangeValue","IDBKeyRange","bound","Infinity","e","cursor","id","push","removeMessageById","request","getOldMessages","msgObk","cleanOldMessages","tooOld","all","map","msgObj","closed","eMIs","writeBlockPromise","resolve","readQueuePromises","_readLoop","readNewMessages","_filterMessage","messagesCallbackTime","newerMessages","useMessages","filter","sort","msgObjA","msgObjB","forEach","KEY_PREFIX","getLocalStorage","localStorage","storageKey","key","writeObj","token","setItem","document","createEvent","initEvent","newValue","dispatchEvent","addStorageEventListener","listener","addEventListener","removeStorageEventListener","removeEventListener","ls","removeItem","defaultTime","userAgent","navigator","toLowerCase","includes","SIMULATE_CHANNELS","name","channelArray","Array","from","channel","METHODS","NativeMethod","IndexeDbMethod","LocalstorageMethod","NodeMethod","require","chooseMethod","chooseMethods","concat","Boolean","SimulateMethod","find","m","useMethod","method","_iL","_onML","_addEL","message","internal","_befC","_prepP","_prepareChannel","_post","postInternal","listenObj","_removeListenerObject","_addListenerObject","_this","awaitPrepare","_state","broadcastChannel","maybePromise","s","_hasMessageListeners","_startListening","o","_stopListening","listenerFn","broadcastQueryClient","queryClient","tx","cb","queryCache","getQueryCache","subscribe","queryEvent","query","queryHash","queryKey","action","setState","build","remove"],"mappings":"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"}